{"id":"zapshipr-backend-26s","title":"Обновить документацию для Inspirations System","description":"## Описание\nОбновить проектную документацию после реализации системы вдохновений.\n\n## Задачи\n\n### Обновить документы в docs/\n- docs/03-modules.md — добавить описание Inspiration Module\n- docs/04-database.md — добавить новые таблицы (rawInspirations, inspirationsExtractions, workspaceTags)\n- docs/05-queues-workers.md — добавить описание worker inspirations:process\n\n### Описать новые возможности\n- Raw Inspirations (типы: image, link, text, document)\n- Inspirations Extractions (структура для LLM)\n- Workspace Tags (автогенерация + ручное управление)\n- Main Prompt (контекст для AI)\n\n### Архитектура и API\n- Схемы БД и связи\n- API endpoints (15 новых)\n- Worker workflow\n- Security considerations\n\n## Документация\ntasks/inspirations-system.md раздел 14\n\n## Оценка\n2 часа\n\n## Блокировщик\nЗависит от: zapshipr-backend-704 (Phase 3)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T13:11:13.623852+08:00","created_by":"romansmolin","updated_at":"2026-01-02T13:11:13.623852+08:00","labels":["documentation","inspirations","low-priority"],"dependencies":[{"issue_id":"zapshipr-backend-26s","depends_on_id":"zapshipr-backend-704","type":"blocks","created_at":"2026-01-02T13:11:50.215462+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-6qj","title":"Phase 1: База данных + Raw Inspirations CRUD","description":"## Описание\nРеализовать базовую инфраструктуру для системы вдохновений: схемы БД, миграции, repositories, CRUD endpoints.\n\n## Задачи\n\n### Database \u0026 Schema\n- Создать миграцию для rawInspirations table\n- Создать миграцию для inspirationsExtractions table\n- Создать миграцию для workspaceTags table\n- Создать миграцию для добавления mainPrompt в workspaces\n- Запустить миграции и проверить схему\n\n### Entity Layer\n- raw-inspiration.schema.ts (Drizzle schema)\n- inspirations-extraction.schema.ts (Drizzle schema)\n- workspace-tag.schema.ts (Drizzle schema)\n- Добавить типы в src/db/schema.ts\n\n### Repository Layer\n- inspirations-repository.interface.ts\n- inspirations.repository.ts (create, findById, findByWorkspaceId, update, delete, checkDuplicateUrl)\n- workspace-tags-repository.interface.ts\n- workspace-tags.repository.ts\n\n### Validation Layer\n- inspirations.schemas.ts (Zod schemas)\n\n### Service Layer\n- inspirations-service.interface.ts\n- inspirations.service.ts (CRUD методы с загрузкой в S3)\n\n### Controller \u0026 Routes\n- inspirations.controller.ts\n- inspirations.routes.ts\n- Интегрировать в app.ts\n\n### Testing\n- Тестирование всех типов inspirations (text, link, image, document)\n- Проверка дубликатов ссылок\n- CRUD операции\n\n## Документация\ntasks/inspirations-system.md разделы 3-4, 5.1-5.2, 7, 9 Phase 1\n\n## Оценка\n3-4 дня","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:09:53.285917+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.286617+08:00","closed_at":"2026-01-02T14:31:29.286617+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-1"]}
{"id":"zapshipr-backend-704","title":"Phase 3: Workspace Tags System","description":"## Описание\nРеализовать систему тегов для workspace: автоматическая генерация из extractions + ручное управление пользователем. Интегрировать синхронизацию тегов в worker.\n\n## Задачи\n\n### Service Layer\n- workspace-tags-service.interface.ts\n- workspace-tags.service.ts\n  - getTags() — с фильтрацией и сортировкой\n  - createTag() — с проверкой дубликатов\n  - updateTag()\n  - deleteTag()\n  - syncTagsFromExtraction() — создание/обновление тегов\n\n### Tag Categorization Logic\n- Эвристика для определения category из suggestedTags:\n  - topic: marketing, sales, growth\n  - format: video, carousel, thread\n  - tone: professional, casual, humorous\n  - style: minimalist, bold, storytelling\n\n### Controller \u0026 Routes\n- workspace-tags.controller.ts\n  - GET /workspaces/:id/tags\n  - POST /workspaces/:id/tags\n  - PUT /workspaces/:id/tags/:tagId\n  - DELETE /workspaces/:id/tags/:tagId\n- workspace-tags.routes.ts\n- Интегрировать в app.ts\n\n### Update Worker\n- Добавить шаг синхронизации тегов после создания extraction\n- WorkspaceTagsService.syncTagsFromExtraction()\n\n### Testing\n- Создание тега вручную\n- Проверка дубликатов тегов\n- Получение тегов с фильтрацией по category\n- Получение тегов с сортировкой по usageCount\n- Автоматическое создание тегов из extraction\n- Обновление usageCount при повторном появлении тега\n\n## Документация\ntasks/inspirations-system.md разделы 4.2, 5.2, 9 Phase 3\n\n## Оценка\n2-3 дня\n\n## Блокировщик\nЗависит от: zapshipr-backend-ctk (Phase 2)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:29.605376+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.289141+08:00","closed_at":"2026-01-02T14:31:29.289141+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-3"],"dependencies":[{"issue_id":"zapshipr-backend-704","depends_on_id":"zapshipr-backend-ctk","type":"blocks","created_at":"2026-01-02T13:11:34.86009+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-bk0","title":"Security \u0026 Validation для Inspirations System","description":"## Описание\nРеализовать security меры и validation для системы вдохновений: проверка файлов, SSRF защита, авторизация.\n\n## Задачи\n\n### File Upload Security\n- Проверка file extension (whitelist: jpg, png, webp, pdf, txt, md, docx)\n- Проверка MIME type с помощью file-type library\n- Проверка размера файла (max 50MB)\n- Private access в S3 bucket\n\n### URL Validation \u0026 SSRF Protection\n- Проверка валидности URL (Zod)\n- Whitelist протоколов: http, https\n- Блокировка private IP ranges:\n  - 127.0.0.0/8 (localhost)\n  - 10.0.0.0/8 (private)\n  - 172.16.0.0/12 (private)\n  - 192.168.0.0/16 (private)\n- Timeout для HTTP requests (30s)\n\n### Authorization\n- Все endpoints проверяют JWT auth\n- Проверка ownership workspace\n- Проверка ownership inspiration при update/delete\n\n## Документация\ntasks/inspirations-system.md раздел 11\n\n## Оценка\n1 день\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:59.836071+08:00","created_by":"romansmolin","updated_at":"2026-01-02T13:10:59.836071+08:00","labels":["high-priority","inspirations","security"],"dependencies":[{"issue_id":"zapshipr-backend-bk0","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:45.096531+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-ctk","title":"Phase 2: Content Parsing + LLM Integration","description":"## Описание\nРеализовать парсинг контента (веб-страницы, PDF, DOCX, YouTube) и интеграцию с OpenAI для создания Inspirations Extractions. Настроить BullMQ worker для асинхронной обработки.\n\n## Зависимости\n- Установить npm пакеты: cheerio, pdf-parse, mammoth, openai, file-type\n\n## Задачи\n\n### Content Parser Service\n- content-parser-service.interface.ts\n- content-parser.service.ts\n  - parseUrl() — парсинг веб-страниц (cheerio)\n  - parseDocument() — парсинг PDF/DOCX\n  - extractVideoMetadata() — YouTube/Vimeo metadata\n  - normalizeContent() — лимит 1500 слов\n  - Error handling \u0026 timeouts (30s)\n\n### LLM Extraction Service\n- llm-extraction-service.interface.ts\n- llm-extraction.service.ts\n  - createExtraction() — вызов OpenAI API (gpt-4o)\n  - buildPromptForExtraction() — построение промпта\n  - Парсинг JSON ответа от OpenAI\n  - Error handling \u0026 retry logic\n\n### BullMQ Worker\n- Создать queue: inspirations:process\n- workers/process-inspiration.worker.ts\n  - Получить rawInspiration из БД\n  - Парсинг контента (ContentParserService)\n  - Сохранить parsedContent в БД\n  - Создать extraction (LlmExtractionService)\n  - Сохранить extraction в БД\n  - Обновить статус на completed\n  - Error handling: статус failed + errorMessage\n  - Retry strategy: 3 attempts, exponential backoff\n\n### Update InspirationsService\n- После создания inspiration → добавить job в queue\n- getInspirationById() — включать extraction в ответ\n\n### Testing\n- Парсинг HTML страницы, YouTube, PDF, DOCX\n- Создание extraction через OpenAI\n- Обработка ошибок (timeout, API errors)\n- End-to-end: создание inspiration → обработка → extraction\n\n## Документация\ntasks/inspirations-system.md разделы 5.2, 5.3, 8, 9 Phase 2\n\n## Оценка\n5-7 дней\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:13.357019+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.288358+08:00","closed_at":"2026-01-02T14:31:29.288358+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-2"],"dependencies":[{"issue_id":"zapshipr-backend-ctk","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:24.421852+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-ft2","title":"Phase 4: Main Prompt для Workspace","description":"## Описание\nДобавить поддержку Main Prompt для workspace - структурированный контекст для AI генерации (brandVoice, targetAudience, coreThemes, contentGoals).\n\n## Задачи\n\n### Update Workspace Service\n- getMainPrompt() — получить main prompt для workspace\n- updateMainPrompt() — обновить main prompt (partial update)\n- Возвращать пустую структуру если mainPrompt = null\n\n### Update Workspace Controller\n- GET /workspaces/:id/prompt\n- PUT /workspaces/:id/prompt\n\n### Update Workspace Routes\n- Добавить новые routes\n- Validation для main prompt structure (Zod schema)\n\n### Testing\n- Получение пустого main prompt\n- Обновление main prompt (полное)\n- Обновление main prompt (partial)\n- Валидация структуры данных\n- Проверка timestamp updatedAt\n\n## Структура Main Prompt\n{\n  brandVoice: string,\n  coreThemes: string[],\n  targetAudience: string,\n  contentGoals: string[],\n  avoidTopics: string[],\n  preferredFormats: string[],\n  additionalContext: string,\n  updatedAt: timestamp\n}\n\n## Документация\ntasks/inspirations-system.md разделы 3.4, 4.3, 6, 9 Phase 4\n\n## Оценка\n1-2 дня\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:44.908264+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.289836+08:00","closed_at":"2026-01-02T14:31:29.289836+08:00","close_reason":"Closed","labels":["feature","inspirations","medium-priority","phase-4"],"dependencies":[{"issue_id":"zapshipr-backend-ft2","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:39.974829+08:00","created_by":"romansmolin"}]}
