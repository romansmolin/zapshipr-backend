{"id":"zapshipr-backend-16e","title":"Обновить статусы inspiration для YouTube workflow","description":"Добавить промежуточные статусы для отслеживания прогресса обработки YouTube видео.\n\n## Acceptance Criteria\n- Добавить статусы в enum: transcript_fetching, transcript_ready, extracting\n- Миграция для обновления enum inspiration_status\n- Обновить типы InspirationStatus в entity\n- Обновить интерфейсы репозитория\n- Обновить фильтры в API\n\n## Новый flow статусов для YouTube\n1. processing → transcript_fetching\n2. transcript_fetching → transcript_ready\n3. transcript_ready → extracting\n4. extracting → completed/failed\n\n## Файлы\n- src/modules/inspiration/entity/raw-inspiration.schema.ts\n- src/db/migrations/XXXX_update_inspiration_status.sql\n- src/modules/inspiration/repositories/inspirations-repository.interface.ts\n\n## Оценка: 1 час","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:22.926953+08:00","created_by":"romansmolin","updated_at":"2026-01-07T16:40:27.912452+08:00","closed_at":"2026-01-07T16:40:27.912452+08:00","close_reason":"Closed","labels":["database","phase-3","status","youtube"]}
{"id":"zapshipr-backend-1fh","title":"Добавить кэширование транскриптов","description":"Кэширование для избежания повторных запросов.\n\n## Acceptance Criteria\n- Ключ кэша для transcript: videoId + language + source\n- Проверка кэша перед запросом транскрипта (в TranscriptRepository)\n- Ключ для extraction: inspirationId + schema_version + model\n- TTL для временных аудио файлов (автоудаление через 1 час)\n- Дедупликация: если другой inspiration с тем же videoId уже имеет транскрипт - использовать его\n\n## Логика\n1. При создании inspiration проверить: есть ли transcript для этого videoId?\n2. Если да - переиспользовать (копия или ссылка)\n3. Если нет - скачать и сохранить\n\n## Файлы\n- src/modules/inspiration/repositories/transcript.repository.ts (обновить)\n- src/modules/inspiration/services/transcript-provider/ (обновить)\n\n## Оценка: 1.5 часа","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T14:24:39.267879+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:24:39.267879+08:00","labels":["cache","optimization","phase-5","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-1fh","depends_on_id":"zapshipr-backend-qnh","type":"blocks","created_at":"2026-01-07T14:27:22.649433+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-26o","title":"Создать таблицу transcripts в БД","description":"Добавить миграцию и entity для хранения транскриптов видео.\n\n## Acceptance Criteria\n- Создать schema src/modules/inspiration/entity/transcript.schema.ts\n- Поля: id, inspiration_id, language, source (HUMAN_CAPTIONS | AUTO_CAPTIONS | STT), format, raw, normalized_text, segments (JSONB)\n- Создать миграцию\n- Экспортировать в src/db/schema.ts\n\n## Файлы\n- src/modules/inspiration/entity/transcript.schema.ts (новый)\n- src/db/migrations/XXXX_add_transcripts.sql (новый)\n- src/db/schema.ts (обновить)\n\n## Оценка: 1 час","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:21:59.469242+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:49:31.404676+08:00","closed_at":"2026-01-07T14:49:31.404676+08:00","close_reason":"Closed","labels":["database","phase-2","youtube"]}
{"id":"zapshipr-backend-26s","title":"Обновить документацию для Inspirations System","description":"## Описание\nОбновить проектную документацию после реализации системы вдохновений.\n\n## Задачи\n\n### Обновить документы в docs/\n- docs/03-modules.md — добавить описание Inspiration Module\n- docs/04-database.md — добавить новые таблицы (rawInspirations, inspirationsExtractions, workspaceTags)\n- docs/05-queues-workers.md — добавить описание worker inspirations:process\n\n### Описать новые возможности\n- Raw Inspirations (типы: image, link, text, document)\n- Inspirations Extractions (структура для LLM)\n- Workspace Tags (автогенерация + ручное управление)\n- Main Prompt (контекст для AI)\n\n### Архитектура и API\n- Схемы БД и связи\n- API endpoints (15 новых)\n- Worker workflow\n- Security considerations\n\n## Документация\ntasks/inspirations-system.md раздел 14\n\n## Оценка\n2 часа\n\n## Блокировщик\nЗависит от: zapshipr-backend-704 (Phase 3)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T13:11:13.623852+08:00","created_by":"romansmolin","updated_at":"2026-01-02T13:11:13.623852+08:00","labels":["documentation","inspirations","low-priority"],"dependencies":[{"issue_id":"zapshipr-backend-26s","depends_on_id":"zapshipr-backend-704","type":"blocks","created_at":"2026-01-02T13:11:50.215462+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-3lr","title":"Написать интеграционные тесты для ContentParserService и LLMExtractionService","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T15:16:38.925417+08:00","created_by":"romansmolin","updated_at":"2026-01-02T15:16:38.925417+08:00","labels":["low-priority","phase-2","testing"]}
{"id":"zapshipr-backend-3n5","title":"Интегрировать yt-dlp для получения субтитров","description":"Создать сервис для получения субтитров YouTube через yt-dlp.\n\n## Acceptance Criteria\n- Создать src/modules/inspiration/services/transcript-provider/transcript-provider.service.ts\n- Интерфейс ITranscriptProviderService\n- Метод getAvailableCaptions(videoId) - список доступных субтитров\n- Метод downloadCaptions(videoId, language, preferHuman) - скачивание VTT/SRT\n- Fallback-цепочка: human (preferredLang) → human (any) → auto (preferredLang) → auto (any)\n- Обработка ошибок (video unavailable, region lock, age restriction)\n\n## Зависимости\n- Требуется установка yt-dlp (npm: yt-dlp-exec или вызов binary)\n\n## Файлы\n- src/modules/inspiration/services/transcript-provider/transcript-provider.service.ts\n- src/modules/inspiration/services/transcript-provider/transcript-provider-service.interface.ts\n\n## Оценка: 3 часа","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:22:25.632769+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:56:24.042711+08:00","closed_at":"2026-01-07T14:56:24.042711+08:00","close_reason":"Closed","labels":["core","phase-2","youtube","yt-dlp"],"dependencies":[{"issue_id":"zapshipr-backend-3n5","depends_on_id":"zapshipr-backend-gsf","type":"blocks","created_at":"2026-01-07T14:26:10.026797+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-6qj","title":"Phase 1: База данных + Raw Inspirations CRUD","description":"## Описание\nРеализовать базовую инфраструктуру для системы вдохновений: схемы БД, миграции, repositories, CRUD endpoints.\n\n## Задачи\n\n### Database \u0026 Schema\n- Создать миграцию для rawInspirations table\n- Создать миграцию для inspirationsExtractions table\n- Создать миграцию для workspaceTags table\n- Создать миграцию для добавления mainPrompt в workspaces\n- Запустить миграции и проверить схему\n\n### Entity Layer\n- raw-inspiration.schema.ts (Drizzle schema)\n- inspirations-extraction.schema.ts (Drizzle schema)\n- workspace-tag.schema.ts (Drizzle schema)\n- Добавить типы в src/db/schema.ts\n\n### Repository Layer\n- inspirations-repository.interface.ts\n- inspirations.repository.ts (create, findById, findByWorkspaceId, update, delete, checkDuplicateUrl)\n- workspace-tags-repository.interface.ts\n- workspace-tags.repository.ts\n\n### Validation Layer\n- inspirations.schemas.ts (Zod schemas)\n\n### Service Layer\n- inspirations-service.interface.ts\n- inspirations.service.ts (CRUD методы с загрузкой в S3)\n\n### Controller \u0026 Routes\n- inspirations.controller.ts\n- inspirations.routes.ts\n- Интегрировать в app.ts\n\n### Testing\n- Тестирование всех типов inspirations (text, link, image, document)\n- Проверка дубликатов ссылок\n- CRUD операции\n\n## Документация\ntasks/inspirations-system.md разделы 3-4, 5.1-5.2, 7, 9 Phase 1\n\n## Оценка\n3-4 дня","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:09:53.285917+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.286617+08:00","closed_at":"2026-01-02T14:31:29.286617+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-1"]}
{"id":"zapshipr-backend-704","title":"Phase 3: Workspace Tags System","description":"## Описание\nРеализовать систему тегов для workspace: автоматическая генерация из extractions + ручное управление пользователем. Интегрировать синхронизацию тегов в worker.\n\n## Задачи\n\n### Service Layer\n- workspace-tags-service.interface.ts\n- workspace-tags.service.ts\n  - getTags() — с фильтрацией и сортировкой\n  - createTag() — с проверкой дубликатов\n  - updateTag()\n  - deleteTag()\n  - syncTagsFromExtraction() — создание/обновление тегов\n\n### Tag Categorization Logic\n- Эвристика для определения category из suggestedTags:\n  - topic: marketing, sales, growth\n  - format: video, carousel, thread\n  - tone: professional, casual, humorous\n  - style: minimalist, bold, storytelling\n\n### Controller \u0026 Routes\n- workspace-tags.controller.ts\n  - GET /workspaces/:id/tags\n  - POST /workspaces/:id/tags\n  - PUT /workspaces/:id/tags/:tagId\n  - DELETE /workspaces/:id/tags/:tagId\n- workspace-tags.routes.ts\n- Интегрировать в app.ts\n\n### Update Worker\n- Добавить шаг синхронизации тегов после создания extraction\n- WorkspaceTagsService.syncTagsFromExtraction()\n\n### Testing\n- Создание тега вручную\n- Проверка дубликатов тегов\n- Получение тегов с фильтрацией по category\n- Получение тегов с сортировкой по usageCount\n- Автоматическое создание тегов из extraction\n- Обновление usageCount при повторном появлении тега\n\n## Документация\ntasks/inspirations-system.md разделы 4.2, 5.2, 9 Phase 3\n\n## Оценка\n2-3 дня\n\n## Блокировщик\nЗависит от: zapshipr-backend-ctk (Phase 2)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:29.605376+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.289141+08:00","closed_at":"2026-01-02T14:31:29.289141+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-3"],"dependencies":[{"issue_id":"zapshipr-backend-704","depends_on_id":"zapshipr-backend-ctk","type":"blocks","created_at":"2026-01-02T13:11:34.86009+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-7kx","title":"Fix eslint dependency for @typescript-eslint/eslint-plugin","description":"npm run lint fails because @typescript-eslint/eslint-plugin is missing in eslint.config.mjs imports.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-04T14:46:40.021806+08:00","created_by":"romansmolin","updated_at":"2026-01-04T14:46:40.021806+08:00","comments":[{"id":1,"issue_id":"zapshipr-backend-7kx","author":"romansmolin","text":"Ran \"npm run lint\" during inspiration updates; still failing due to missing @typescript-eslint/eslint-plugin.","created_at":"2026-01-04T09:32:34Z"},{"id":2,"issue_id":"zapshipr-backend-7kx","author":"romansmolin","text":"Lint still fails after post-ideas change: missing @typescript-eslint/eslint-plugin (npm run lint).","created_at":"2026-01-04T09:43:59Z"},{"id":3,"issue_id":"zapshipr-backend-7kx","author":"romansmolin","text":"Ran \"npm run lint\" after drizzle migration generation; still fails due to missing @typescript-eslint/eslint-plugin.","created_at":"2026-01-04T09:49:31Z"},{"id":4,"issue_id":"zapshipr-backend-7kx","author":"romansmolin","text":"Ran npm run lint after adding drizzle helper scripts; still fails due to missing @typescript-eslint/eslint-plugin.","created_at":"2026-01-04T10:06:14Z"}]}
{"id":"zapshipr-backend-a95","title":"Обновить JSON Schema для YouTube extraction","description":"Новая схема extraction специально для YouTube транскриптов с расширенными полями.\n\n## Acceptance Criteria\n- Новые поля в extraction:\n  - hooks: string[] (10-30 штук) - цепляющие первые строки\n  - quotes: { text, startSec, endSec }[] - цитаты с таймкодами\n  - content_angles: { angle, why_it_works }[] - углы подачи контента\n  - drafts: { threads, x, linkedin, instagram_caption } - готовые черновики по платформам\n  - title_guess, language, tone\n\n- Миграция для новых полей в inspirations_extractions\n- JSON Schema для OpenAI structured outputs\n- Обратная совместимость: старые extractions работают\n\n## Схема из документа\nСм. tasks/inpirationsyoutube.md секция 6.2\n\n## Файлы\n- src/modules/inspiration/entity/inspirations-extraction.schema.ts\n- src/modules/inspiration/services/llm-extraction/schemas/youtube-extraction.schema.ts\n- src/db/migrations/XXXX_update_extractions_schema.sql\n\n## Оценка: 2 часа","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:39.157809+08:00","created_by":"romansmolin","updated_at":"2026-01-07T16:28:06.059213+08:00","closed_at":"2026-01-07T16:28:06.059213+08:00","close_reason":"Closed","labels":["llm","phase-4","schema","youtube"]}
{"id":"zapshipr-backend-bk0","title":"Security \u0026 Validation для Inspirations System","description":"## Описание\nРеализовать security меры и validation для системы вдохновений: проверка файлов, SSRF защита, авторизация.\n\n## Задачи\n\n### File Upload Security\n- Проверка file extension (whitelist: jpg, png, webp, pdf, txt, md, docx)\n- Проверка MIME type с помощью file-type library\n- Проверка размера файла (max 50MB)\n- Private access в S3 bucket\n\n### URL Validation \u0026 SSRF Protection\n- Проверка валидности URL (Zod)\n- Whitelist протоколов: http, https\n- Блокировка private IP ranges:\n  - 127.0.0.0/8 (localhost)\n  - 10.0.0.0/8 (private)\n  - 172.16.0.0/12 (private)\n  - 192.168.0.0/16 (private)\n- Timeout для HTTP requests (30s)\n\n### Authorization\n- Все endpoints проверяют JWT auth\n- Проверка ownership workspace\n- Проверка ownership inspiration при update/delete\n\n## Документация\ntasks/inspirations-system.md раздел 11\n\n## Оценка\n1 день\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:59.836071+08:00","created_by":"romansmolin","updated_at":"2026-01-02T13:10:59.836071+08:00","labels":["high-priority","inspirations","security"],"dependencies":[{"issue_id":"zapshipr-backend-bk0","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:45.096531+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-cax","title":"Создать TranscriptNormalizerService","description":"Сервис для очистки и нормализации транскриптов.\n\n## Acceptance Criteria\n- Парсинг VTT формата (WEBVTT headers, cue timing, cue text)\n- Парсинг SRT формата (номера, таймкоды, текст)\n- Удаление таймкодов и метаданных из текста\n- Удаление повторяющихся фраз (характерно для auto captions)\n- Нормализация пробелов и переносов\n- Сохранение сегментов с таймкодами в структурированном виде\n- Unit тесты для VTT и SRT\n\n## Выходной формат\n```ts\ninterface TranscriptSegment {\n  startSec: number\n  endSec: number  \n  text: string\n}\n\ninterface NormalizedTranscript {\n  normalizedText: string\n  segments: TranscriptSegment[]\n  language: string | null\n}\n```\n\n## Файлы\n- src/modules/inspiration/services/transcript-normalizer/transcript-normalizer.service.ts\n- src/modules/inspiration/services/transcript-normalizer/__tests__/\n\n## Оценка: 2 часа","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:22:54.604537+08:00","created_by":"romansmolin","updated_at":"2026-01-07T15:26:18.688452+08:00","closed_at":"2026-01-07T15:26:18.688452+08:00","close_reason":"Closed","labels":["normalizer","phase-3","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-cax","depends_on_id":"zapshipr-backend-qnh","type":"blocks","created_at":"2026-01-07T14:26:24.486936+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-ctk","title":"Phase 2: Content Parsing + LLM Integration","description":"## Описание\nРеализовать парсинг контента (веб-страницы, PDF, DOCX, YouTube) и интеграцию с OpenAI для создания Inspirations Extractions. Настроить BullMQ worker для асинхронной обработки.\n\n## Зависимости\n- Установить npm пакеты: cheerio, pdf-parse, mammoth, openai, file-type\n\n## Задачи\n\n### Content Parser Service\n- content-parser-service.interface.ts\n- content-parser.service.ts\n  - parseUrl() — парсинг веб-страниц (cheerio)\n  - parseDocument() — парсинг PDF/DOCX\n  - extractVideoMetadata() — YouTube/Vimeo metadata\n  - normalizeContent() — лимит 1500 слов\n  - Error handling \u0026 timeouts (30s)\n\n### LLM Extraction Service\n- llm-extraction-service.interface.ts\n- llm-extraction.service.ts\n  - createExtraction() — вызов OpenAI API (gpt-4o)\n  - buildPromptForExtraction() — построение промпта\n  - Парсинг JSON ответа от OpenAI\n  - Error handling \u0026 retry logic\n\n### BullMQ Worker\n- Создать queue: inspirations:process\n- workers/process-inspiration.worker.ts\n  - Получить rawInspiration из БД\n  - Парсинг контента (ContentParserService)\n  - Сохранить parsedContent в БД\n  - Создать extraction (LlmExtractionService)\n  - Сохранить extraction в БД\n  - Обновить статус на completed\n  - Error handling: статус failed + errorMessage\n  - Retry strategy: 3 attempts, exponential backoff\n\n### Update InspirationsService\n- После создания inspiration → добавить job в queue\n- getInspirationById() — включать extraction в ответ\n\n### Testing\n- Парсинг HTML страницы, YouTube, PDF, DOCX\n- Создание extraction через OpenAI\n- Обработка ошибок (timeout, API errors)\n- End-to-end: создание inspiration → обработка → extraction\n\n## Документация\ntasks/inspirations-system.md разделы 5.2, 5.3, 8, 9 Phase 2\n\n## Оценка\n5-7 дней\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:13.357019+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.288358+08:00","closed_at":"2026-01-02T14:31:29.288358+08:00","close_reason":"Closed","labels":["feature","high-priority","inspirations","phase-2"],"dependencies":[{"issue_id":"zapshipr-backend-ctk","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:24.421852+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-e62","title":"Epic: YouTube Transcript → Ideas Extraction","description":"Реализация полноценного пайплайна получения транскрипта YouTube видео и генерации структурированных идей для постов.\n\n## Цели\n- Получать транскрипт видео (human/auto captions или STT fallback)\n- Нормализовать и чанкить транскрипт\n- Генерировать structured extraction (hooks, quotes, drafts по платформам)\n- Quality gate для валидации результатов\n\n## Текущее состояние\nСейчас для YouTube анализируется только description видео, НЕ транскрипт. Нужно добавить полноценный transcript pipeline.\n\n## Phases\n1. URL Normalizer \u0026 Types\n2. Transcript Provider (yt-dlp + STT)\n3. Transcript Processing (normalize, chunk)\n4. LLM Extraction Update (new schema, map-reduce)\n5. Worker \u0026 Integration\n6. Testing \u0026 Documentation\n\n## Оценка: ~28 часов","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-07T14:21:30.173884+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:21:30.173884+08:00","labels":["inspirations","transcript","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-e62","depends_on_id":"zapshipr-backend-elq","type":"blocks","created_at":"2026-01-07T14:29:31.732059+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-e62","depends_on_id":"zapshipr-backend-xnd","type":"blocks","created_at":"2026-01-07T14:29:36.862961+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-e62","depends_on_id":"zapshipr-backend-x56","type":"blocks","created_at":"2026-01-07T14:29:41.992872+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-e62","depends_on_id":"zapshipr-backend-j97","type":"blocks","created_at":"2026-01-07T14:29:47.131762+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-e62","depends_on_id":"zapshipr-backend-1fh","type":"blocks","created_at":"2026-01-07T14:29:52.266699+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-elq","title":"Обновить документацию для YouTube Transcript","description":"Документация нового функционала.\n\n## Acceptance Criteria\n- Обновить docs/03-modules.md:\n  - Описание YouTube Transcript Provider\n  - Описание новых сервисов (TranscriptNormalizer, MapReduceExtractor)\n  \n- Обновить docs/05-queues-workers.md:\n  - Новый workflow для YouTube\n  - Описание статусов и переходов\n  \n- Добавить описание YouTube workflow:\n  - Диаграмма пайплайна\n  - Описание fallback стратегий\n  - Troubleshooting (типичные ошибки)\n  \n- Примеры API запросов:\n  - POST /inspirations с YouTube URL\n  - POST /inspirations/:id/extract\n  - GET /inspirations/:id (с транскриптом)\n\n- Добавить секцию про environment variables:\n  - YOUTUBE_API_KEY\n  - YT_DLP_PATH (опционально)\n\n## Файлы\n- docs/03-modules.md\n- docs/05-queues-workers.md\n- docs/10-environment.md\n\n## Оценка: 1.5 часа","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T14:25:38.437992+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:25:38.437992+08:00","labels":["documentation","phase-6","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-elq","depends_on_id":"zapshipr-backend-t6v","type":"blocks","created_at":"2026-01-07T14:28:30.226951+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-faf","title":"Enable image vision input and document parsing for inspirations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T17:32:49.050923+08:00","created_by":"romansmolin","updated_at":"2026-01-04T17:32:58.02534+08:00","closed_at":"2026-01-04T17:32:58.02534+08:00","close_reason":"Closed"}
{"id":"zapshipr-backend-fnn","title":"Реализовать Map-Reduce для длинных транскриптов","description":"Двухпроходная обработка длинных транскриптов через LLM.\n\n## Acceptance Criteria\n- Pass A (Map): каждый чанк → chunk_notes (тезисы, цитаты с таймкодами, темы)\n- Pass B (Reduce): все chunk_notes объединить → финальный extraction JSON\n- Порог для переключения: транскрипт \u003e 6000 токенов\n- Логирование токенов и стоимости для каждого прохода\n- Сохранение промежуточных chunk_notes (для debug)\n\n## Промежуточный формат chunk_notes\n```ts\ninterface ChunkNotes {\n  chunkIndex: number\n  keyPoints: string[]\n  quotes: { text: string; startSec: number | null }[]\n  topics: string[]\n}\n```\n\n## Файлы\n- src/modules/inspiration/services/llm-extraction/map-reduce-extractor.ts\n- src/modules/inspiration/services/llm-extraction/prompts/map-prompt.ts\n- src/modules/inspiration/services/llm-extraction/prompts/reduce-prompt.ts\n\n## Оценка: 3 часа","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:54.119209+08:00","created_by":"romansmolin","updated_at":"2026-01-07T16:33:24.583384+08:00","closed_at":"2026-01-07T16:33:24.583384+08:00","close_reason":"Closed","labels":["llm","map-reduce","phase-4","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-fnn","depends_on_id":"zapshipr-backend-oy7","type":"blocks","created_at":"2026-01-07T14:26:39.952968+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-fnn","depends_on_id":"zapshipr-backend-a95","type":"blocks","created_at":"2026-01-07T14:26:45.095885+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-ft2","title":"Phase 4: Main Prompt для Workspace","description":"## Описание\nДобавить поддержку Main Prompt для workspace - структурированный контекст для AI генерации (brandVoice, targetAudience, coreThemes, contentGoals).\n\n## Задачи\n\n### Update Workspace Service\n- getMainPrompt() — получить main prompt для workspace\n- updateMainPrompt() — обновить main prompt (partial update)\n- Возвращать пустую структуру если mainPrompt = null\n\n### Update Workspace Controller\n- GET /workspaces/:id/prompt\n- PUT /workspaces/:id/prompt\n\n### Update Workspace Routes\n- Добавить новые routes\n- Validation для main prompt structure (Zod schema)\n\n### Testing\n- Получение пустого main prompt\n- Обновление main prompt (полное)\n- Обновление main prompt (partial)\n- Валидация структуры данных\n- Проверка timestamp updatedAt\n\n## Структура Main Prompt\n{\n  brandVoice: string,\n  coreThemes: string[],\n  targetAudience: string,\n  contentGoals: string[],\n  avoidTopics: string[],\n  preferredFormats: string[],\n  additionalContext: string,\n  updatedAt: timestamp\n}\n\n## Документация\ntasks/inspirations-system.md разделы 3.4, 4.3, 6, 9 Phase 4\n\n## Оценка\n1-2 дня\n\n## Блокировщик\nЗависит от: zapshipr-backend-6qj (Phase 1)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:10:44.908264+08:00","created_by":"romansmolin","updated_at":"2026-01-02T14:31:29.289836+08:00","closed_at":"2026-01-02T14:31:29.289836+08:00","close_reason":"Closed","labels":["feature","inspirations","medium-priority","phase-4"],"dependencies":[{"issue_id":"zapshipr-backend-ft2","depends_on_id":"zapshipr-backend-6qj","type":"blocks","created_at":"2026-01-02T13:11:39.974829+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-gsf","title":"Создать тип CanonicalVideoRef и URL нормализатор","description":"Создать детерминированный нормализатор YouTube URL, который превращает любой формат ссылки в единый канонический формат.\n\n## Acceptance Criteria\n- Создать тип CanonicalVideoRef в src/modules/inspiration/types/youtube.types.ts\n- Создать функцию normalizeYouTubeUrl() в src/modules/inspiration/utils/youtube-url-normalizer.ts\n- Поддержка форматов: watch, youtu.be, shorts, embed\n- Парсинг t/start в startSec (форматы: 1h2m3s, 90, 90s)\n- Игнорирование маркетинговых параметров (pp, si, feature, utm_*)\n- Извлечение playlistId (если есть)\n- Unit тесты для всех форматов URL\n\n## Файлы\n- src/modules/inspiration/types/youtube.types.ts (новый)\n- src/modules/inspiration/utils/youtube-url-normalizer.ts (новый)\n- src/modules/inspiration/utils/__tests__/youtube-url-normalizer.test.ts (новый)\n\n## Оценка: 2 часа","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:21:46.426359+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:37:35.835626+08:00","closed_at":"2026-01-07T14:37:35.835626+08:00","close_reason":"Closed","labels":["phase-1","types","youtube"]}
{"id":"zapshipr-backend-hif","title":"Реализовать Quality Gate для extraction","description":"Валидация качества extraction с автоматическим retry.\n\n## Acceptance Criteria\n- Проверка минимумов:\n  - hooks \u003e= 10\n  - key_points \u003e= 5\n  - quotes \u003e= 3\n  - drafts не пустые (минимум 2 для каждой платформы)\n- Проверка на 'воду' (слишком общие формулировки):\n  - Нет повторяющихся hooks\n  - Конкретные цифры/имена в key_points\n- 1 автоматический retry с усиленными требованиями в промпте\n- Логирование качества и причин retry\n- Метрика quality_score для аналитики\n\n## Файлы\n- src/modules/inspiration/services/llm-extraction/quality-gate.ts\n- src/modules/inspiration/services/llm-extraction/prompts/retry-prompt.ts\n\n## Оценка: 1.5 часа","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:24:08.085545+08:00","created_by":"romansmolin","updated_at":"2026-01-07T16:38:38.903282+08:00","closed_at":"2026-01-07T16:38:38.903282+08:00","close_reason":"Closed","labels":["phase-4","quality","validation","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-hif","depends_on_id":"zapshipr-backend-a95","type":"blocks","created_at":"2026-01-07T14:26:50.232044+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-hwu","title":"Реализовать STT fallback через OpenAI Whisper","description":"Если субтитры недоступны, скачать аудио и транскрибировать через Whisper API.\n\n## Acceptance Criteria\n- Метод downloadAudio(videoId) через yt-dlp\n- Метод transcribeAudio(audioPath, language?) через OpenAI Whisper API\n- Временное хранение аудио с автоудалением после транскрибации\n- Обработка лимитов (размер файла до 25MB, длительность)\n- Логирование использования и стоимости\n\n## Ограничения Whisper API\n- Max file size: 25 MB\n- Supported formats: mp3, mp4, mpeg, mpga, m4a, wav, webm\n- Для длинных видео может потребоваться chunking аудио\n\n## Файлы\n- src/modules/inspiration/services/transcript-provider/stt.service.ts\n- temp/audio/ (временные файлы)\n\n## Оценка: 2.5 часа","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:22:39.791883+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:59:24.026183+08:00","closed_at":"2026-01-07T14:59:24.026183+08:00","close_reason":"Closed","labels":["openai","phase-2","stt","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-hwu","depends_on_id":"zapshipr-backend-3n5","type":"blocks","created_at":"2026-01-07T14:26:15.175916+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-j97","title":"Добавить endpoint POST /inspirations/:id/extract","description":"Ручной запуск extraction для inspiration.\n\n## Acceptance Criteria\n- POST /api/v1/inspirations/:id/extract endpoint\n- Валидация:\n  - inspiration существует\n  - inspiration принадлежит workspace пользователя\n  - статус = transcript_ready (для YouTube) или completed (для retry)\n- Возможность указать параметры:\n  - forceRefresh: boolean - игнорировать кэш\n  - model: string - указать модель LLM\n- Response: { status: 'queued', jobId }\n\n## Файлы\n- src/modules/inspiration/routes/inspirations.routes.ts\n- src/modules/inspiration/controllers/inspirations.controller.ts\n- src/modules/inspiration/services/inspirations.service.ts\n\n## Оценка: 1 час","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T14:24:53.006106+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:24:53.006106+08:00","labels":["api","phase-5","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-j97","depends_on_id":"zapshipr-backend-t6v","type":"blocks","created_at":"2026-01-07T14:27:27.765382+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-nan","title":"Fix inspiration worker metadata source","description":"Worker was passing metadata without required 'source' field, causing TS compile error. Update metadata composition to include buildInspirationMetadataSource.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T17:35:33.7642+08:00","created_by":"romansmolin","updated_at":"2026-01-06T17:35:41.12198+08:00","closed_at":"2026-01-06T17:35:41.12198+08:00","close_reason":"Closed","labels":["inspirations","worker"]}
{"id":"zapshipr-backend-ogb","title":"Написать интеграционные тесты для WorkspaceTagsService","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T15:16:48.846767+08:00","created_by":"romansmolin","updated_at":"2026-01-03T13:07:03.470776+08:00","closed_at":"2026-01-03T13:07:03.470776+08:00","close_reason":"Closed","labels":["low-priority","phase-3","testing"]}
{"id":"zapshipr-backend-oy7","title":"Реализовать Chunking для длинных транскриптов","description":"Разбиение длинных транскриптов на чанки для LLM.\n\n## Acceptance Criteria\n- Функция chunkTranscript(text, maxTokens, segments?) в utils\n- Размер чанка: 2000-4000 токенов (настраиваемо)\n- Разрезание по границам сегментов/предложений (не в середине слова/предложения)\n- Сохранение связи с таймкодами (каждый чанк знает свой startSec/endSec)\n- Подсчет токенов через tiktoken или простую эвристику (1 token ≈ 4 chars)\n\n## Выходной формат\n```ts\ninterface TranscriptChunk {\n  index: number\n  text: string\n  tokenCount: number\n  startSec: number | null\n  endSec: number | null\n}\n```\n\n## Файлы\n- src/modules/inspiration/utils/transcript-chunker.ts\n- src/modules/inspiration/utils/__tests__/transcript-chunker.test.ts\n\n## Оценка: 1.5 часа","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:23:09.260036+08:00","created_by":"romansmolin","updated_at":"2026-01-07T16:21:57.700613+08:00","closed_at":"2026-01-07T16:21:57.700613+08:00","close_reason":"Closed","labels":["chunking","phase-3","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-oy7","depends_on_id":"zapshipr-backend-cax","type":"blocks","created_at":"2026-01-07T14:26:29.630645+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-qnh","title":"Создать TranscriptRepository","description":"Репозиторий для работы с транскриптами.\n\n## Acceptance Criteria\n- Интерфейс ITranscriptRepository\n- Реализация TranscriptRepository\n- CRUD операции + findByInspirationId + findByVideoIdAndLanguage (для кэша)\n\n## Файлы\n- src/modules/inspiration/repositories/transcript-repository.interface.ts\n- src/modules/inspiration/repositories/transcript.repository.ts\n\n## Оценка: 1.5 часа","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:22:10.889487+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:52:35.099904+08:00","closed_at":"2026-01-07T14:52:35.099904+08:00","close_reason":"Closed","labels":["phase-2","repository","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-qnh","depends_on_id":"zapshipr-backend-26o","type":"blocks","created_at":"2026-01-07T14:26:04.878774+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-t6v","title":"Обновить InspirationWorker для YouTube workflow","description":"Интегрировать новый пайплайн транскриптов в существующий worker.\n\n## Acceptance Criteria\n- Определение типа контента (YouTube vs другие) по CanonicalVideoRef\n- Для YouTube новый flow:\n  1. URL normalize → CanonicalVideoRef\n  2. Metadata fetch (уже есть)\n  3. Transcript fetch (captions → STT fallback)\n  4. Transcript normalize\n  5. Chunk (если длинный)\n  6. Extract (single или map-reduce)\n  7. Quality gate\n  8. Save\n- Обновление статусов на каждом шаге\n- Сохранение transcript в БД\n- Обработка ошибок с понятными сообщениями:\n  - no_captions_no_audio_access\n  - video_unavailable\n  - age_restricted\n  - extraction_quality_failed\n\n## Файлы\n- src/shared/queue/worker/inspiration-worker/bullmq-inspiration-worker.ts\n- src/shared/queue/worker/inspiration-worker/youtube-processor.ts (новый)\n\n## Оценка: 3 часа","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T14:24:23.794521+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:24:23.794521+08:00","labels":["integration","phase-5","worker","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-t6v","depends_on_id":"zapshipr-backend-hwu","type":"blocks","created_at":"2026-01-07T14:27:02.133038+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-t6v","depends_on_id":"zapshipr-backend-fnn","type":"blocks","created_at":"2026-01-07T14:27:07.257848+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-t6v","depends_on_id":"zapshipr-backend-hif","type":"blocks","created_at":"2026-01-07T14:27:12.384065+08:00","created_by":"romansmolin"},{"issue_id":"zapshipr-backend-t6v","depends_on_id":"zapshipr-backend-16e","type":"blocks","created_at":"2026-01-07T14:27:17.519059+08:00","created_by":"romansmolin"}]}
{"id":"zapshipr-backend-wvn","title":"Fix Inspirations build/test type errors","description":"Build/test currently fail with TypeScript errors in inspirations routes and service tests (missing/renamed types, method arity mismatches, controller retry handler). Investigate API changes and update tests/routes accordingly.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-06T17:35:18.330672+08:00","created_by":"romansmolin","updated_at":"2026-01-06T17:35:18.330672+08:00","labels":["build","inspirations","tests"]}
{"id":"zapshipr-backend-x56","title":"Unit тесты для YouTube модуля","description":"Покрытие тестами новых компонентов.\n\n## Acceptance Criteria\n- Тесты для URL normalizer:\n  - Все форматы YouTube URL (watch, youtu.be, shorts, embed)\n  - Парсинг timestamp (t=90, t=1h2m3s)\n  - Игнорирование маркетинговых параметров\n  - Edge cases (invalid URLs, missing videoId)\n\n- Тесты для VTT/SRT parser:\n  - Корректный парсинг VTT\n  - Корректный парсинг SRT\n  - Удаление дубликатов фраз\n  - Сохранение таймкодов\n\n- Тесты для chunker:\n  - Разбиение по токенам\n  - Сохранение границ предложений\n  - Edge cases (пустой текст, очень длинные слова)\n\n- Тесты для quality gate:\n  - Валидация минимумов\n  - Детекция воды\n\n- Mocks для yt-dlp и OpenAI\n\n## Файлы\n- src/modules/inspiration/utils/__tests__/\n- src/modules/inspiration/services/__tests__/\n\n## Оценка: 2 часа","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T14:25:08.770884+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:25:08.770884+08:00","labels":["phase-6","testing","youtube"]}
{"id":"zapshipr-backend-xnd","title":"Integration тесты YouTube пайплайна","description":"E2E тесты пайплайна обработки YouTube видео.\n\n## Acceptance Criteria\n- Тест: URL → transcript → extraction (с mock yt-dlp)\n  - Happy path с human captions\n  - Fallback на auto captions\n  \n- Тест: видео без субтитров → STT → extraction\n  - Mock OpenAI Whisper API\n  \n- Тест: длинный транскрипт → chunking → map-reduce → extraction\n  - Проверка корректности объединения chunks\n  \n- Тест: ошибка → retry → success/fail\n  - Проверка exponential backoff\n  - Проверка обновления статуса на failed\n\n- Тест: качество не прошло → retry с усиленным промптом\n\n## Файлы\n- src/shared/queue/worker/inspiration-worker/__tests__/youtube-workflow.test.ts\n\n## Оценка: 2 часа","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T14:25:23.406831+08:00","created_by":"romansmolin","updated_at":"2026-01-07T14:25:23.406831+08:00","labels":["integration","phase-6","testing","youtube"],"dependencies":[{"issue_id":"zapshipr-backend-xnd","depends_on_id":"zapshipr-backend-t6v","type":"blocks","created_at":"2026-01-07T14:28:25.099757+08:00","created_by":"romansmolin"}]}
