# Очереди и воркеры

## BullMQ

Проект использует BullMQ для фоновой обработки задач с Redis в качестве брокера сообщений.

### Архитектура

- **Конфигурация**: `src/shared/queue/`
- **Воркеры**: `src/workers/`
- **Точка входа**: `src/worker.ts`
- **Отдельный процесс**: `npm run worker:dev`

### Типы задач

#### 1. Публикация постов в соцсети
- Обработка запланированных публикаций
- Отправка постов на платформы через publishers
- Обновление статусов `postTargets`

#### 2. Обновление токенов доступа
- Периодическая проверка истекающих токенов
- Автоматическое обновление через refresh tokens
- Обработка ошибок обновления

#### 3. Обработка медиа-файлов
- Конвертация видео в совместимые форматы
- Оптимизация изображений
- Загрузка в S3

### Запуск воркеров

```bash
# Development
npm run worker:dev

# Production
npm run worker
```

### Важные замечания

- Воркеры должны работать в отдельном процессе от API сервера
- Redis должен быть доступен для работы очередей
- Обработка ошибок происходит через `SocialMediaErrorHandler`
- Повторные попытки настраиваются в конфигурации очередей

