"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createAccountsRouter = void 0;
const express_1 = require("express");
const auth_middleware_1 = require("@/middleware/auth.middleware");
const account_repository_1 = require("@/modules/social/repositories/account.repository");
const accounts_controller_1 = require("@/modules/social/controllers/accounts.controller");
const accounts_service_1 = require("@/modules/social/services/accounts.service");
const oauth_state_service_1 = require("@/modules/social/services/oauth-state.service");
const social_media_connector_service_1 = require("@/modules/social/services/social-media-connector.service");
const connect_account_use_case_1 = require("@/modules/social/use-cases/connect-account.use-case");
const delete_account_use_case_1 = require("@/modules/social/use-cases/delete-account.use-case");
const find_expiring_accounts_use_case_1 = require("@/modules/social/use-cases/find-expiring-accounts.use-case");
const get_account_by_id_use_case_1 = require("@/modules/social/use-cases/get-account-by-id.use-case");
const get_pinterest_boards_use_case_1 = require("@/modules/social/use-cases/get-pinterest-boards.use-case");
const list_accounts_use_case_1 = require("@/modules/social/use-cases/list-accounts.use-case");
const update_access_token_by_id_use_case_1 = require("@/modules/social/use-cases/update-access-token-by-id.use-case");
const update_access_token_use_case_1 = require("@/modules/social/use-cases/update-access-token.use-case");
const async_handler_1 = require("@/shared/http/async-handler");
const axios_http_client_1 = require("@/shared/http-client/axios-http-client");
const media_uploader_1 = require("@/shared/media-uploader/media-uploader");
const createAccountsRouter = (logger, db) => {
    const router = (0, express_1.Router)();
    const accountRepository = new account_repository_1.AccountRepository(db, logger);
    const mediaUploader = new media_uploader_1.S3Uploader(logger);
    const apiClient = new axios_http_client_1.AxiosHttpClient();
    const connectAccountUseCase = new connect_account_use_case_1.ConnectAccountUseCase(accountRepository, logger);
    const listAccountsUseCase = new list_accounts_use_case_1.ListAccountsUseCase(accountRepository, logger);
    const getAccountByIdUseCase = new get_account_by_id_use_case_1.GetAccountByIdUseCase(accountRepository, logger);
    const deleteAccountUseCase = new delete_account_use_case_1.DeleteAccountUseCase(accountRepository, logger, mediaUploader);
    const getPinterestBoardsUseCase = new get_pinterest_boards_use_case_1.GetPinterestBoardsUseCase(accountRepository, logger);
    const updateAccessTokenUseCase = new update_access_token_use_case_1.UpdateAccessTokenUseCase(accountRepository, logger);
    const updateAccessTokenByIdUseCase = new update_access_token_by_id_use_case_1.UpdateAccessTokenByIdUseCase(accountRepository, logger);
    const findExpiringAccountsUseCase = new find_expiring_accounts_use_case_1.FindExpiringAccountsUseCase(accountRepository, logger);
    const accountsService = new accounts_service_1.AccountsService(connectAccountUseCase, listAccountsUseCase, getAccountByIdUseCase, deleteAccountUseCase, getPinterestBoardsUseCase, updateAccessTokenUseCase, updateAccessTokenByIdUseCase, findExpiringAccountsUseCase);
    const connectorService = new social_media_connector_service_1.SocilaMediaConnectorService(logger, mediaUploader, accountRepository, apiClient, accountsService);
    const oauthStateService = new oauth_state_service_1.OAuthStateService();
    const accountsController = new accounts_controller_1.AccountsController(accountsService, connectorService, logger, oauthStateService);
    router.get('/facebook/authorize', auth_middleware_1.authMiddleware, (0, async_handler_1.asyncHandler)(accountsController.initiateOAuth.bind(accountsController)));
    router.get('/facebook/callback', (0, async_handler_1.asyncHandler)(accountsController.connectFacebookAccount.bind(accountsController)));
    router.get('/threads/callback', (0, async_handler_1.asyncHandler)(accountsController.connectThreadsAccount.bind(accountsController)));
    router.get('/tiktok/callback', (0, async_handler_1.asyncHandler)(accountsController.connectTikTokAccount.bind(accountsController)));
    router.get('/youtube/callback', (0, async_handler_1.asyncHandler)(accountsController.connectYouTubeAccount.bind(accountsController)));
    router.get('/x/callback', (0, async_handler_1.asyncHandler)(accountsController.connectXAccount.bind(accountsController)));
    router.get('/pinterest/callback', (0, async_handler_1.asyncHandler)(accountsController.connectPinterestAccount.bind(accountsController)));
    router.get('/instagram/callback', (0, async_handler_1.asyncHandler)(accountsController.connectInstagramAccount.bind(accountsController)));
    router.get('/linkedin/callback', (0, async_handler_1.asyncHandler)(accountsController.connectLinkedinAccount.bind(accountsController)));
    router.use(auth_middleware_1.authMiddleware);
    router.post('/oauth/state', (0, async_handler_1.asyncHandler)(accountsController.createOAuthState.bind(accountsController)));
    router.post('/bluesky/connect', (0, async_handler_1.asyncHandler)(accountsController.connectBlueskyAccount.bind(accountsController)));
    router.get('/accounts', (0, async_handler_1.asyncHandler)(accountsController.getAllAccounts.bind(accountsController)));
    router.delete('/accounts/:accountId', (0, async_handler_1.asyncHandler)(accountsController.deleteAccount.bind(accountsController)));
    router.get('/accounts/:socialAccountId/pinterest-boards', (0, async_handler_1.asyncHandler)(accountsController.getPinterestBoards.bind(accountsController)));
    return router;
};
exports.createAccountsRouter = createAccountsRouter;
